<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Stlite app</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@stlite/browser@0.89.1/build/stlite.css"
    />
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
import { mount } from "https://cdn.jsdelivr.net/npm/@stlite/browser@0.89.1/build/stlite.js"
mount(
  {
    requirements: ["streamlit-hierarchy-chart"],
    entrypoint: "streamlit_app.py",
    files: {
"streamlit_app.py": `import streamlit as st
import pandas as pd

from streamlit_hierarchy_chart import hierarchy_chart
from utils import cx_credit_mtree

# Add some test code to play with the component while it's in development.
# During development, we can run this just as we would any other Streamlit
# app: \`$ streamlit run my_component/example.py\`

st.subheader("Component with constant args")

# Create an instance of our component with a constant \`name\` arg, and
# print its output value.

df = pd.read_csv('test.csv')  
main_dt = '2025-01-01'
comparator_dt = '2025-02-01'

cx_credit_mtree_res = cx_credit_mtree(df,main_dt,comparator_dt)

data = cx_credit_mtree_res[0] 
metric_keys = cx_credit_mtree_res[1]
selected_metric_key = hierarchy_chart(data=data)


st.write(selected_metric_key)
selected_metric = metric_keys.get(selected_metric_key)
if selected_metric:
    st.write(selected_metric)
`,
"test.csv": `month,total_calls,answered,total_agents_answered,avg_answered_per_agent,overachiever,underachiever,missed,missed_out_of_working_hours,missed_in_of_working_hours,missed_calc,missed_working_hours,missed_out_working_hours,answer_calc
2025-05-01,4648,4118,6,686,3,3,530,0,530,0.11,1,0,0.89
2025-04-01,11063,8893,14,635,4,10,2170,0,2170,0.2,1,0,0.8
2025-03-01,10124,7219,5,1444,2,3,2905,0,2905,0.29,1,0,0.71
2025-02-01,5895,3580,7,511,3,4,2315,0,2315,0.39,1,0,0.61
2025-01-01,8448,4023,7,575,3,4,4425,35,4390,0.52,0.99,0.01,0.48
2024-12-01,10847,5157,10,516,3,7,5690,374,5316,0.52,0.93,0.07,0.48
2024-11-01,10786,5905,15,394,5,10,4881,2623,2258,0.45,0.46,0.54,0.55
2024-10-01,5782,5239,14,374,8,6,543,190,353,0.09,0.65,0.35,0.91
2024-09-01,8561,7357,15,490,7,8,1204,667,537,0.14,0.45,0.55,0.86
2024-08-01,11372,10321,15,688,9,6,1051,437,614,0.09,0.58,0.42,0.91
2024-07-01,12039,10714,15,714,9,6,1325,558,767,0.11,0.58,0.42,0.89
2024-06-01,13687,11487,15,766,6,9,2200,893,1307,0.16,0.59,0.41,0.84
2024-05-01,15012,11907,15,794,5,10,3105,1361,1744,0.21,0.56,0.44,0.79
2024-04-01,12071,10155,15,677,7,8,1916,960,956,0.16,0.5,0.5,0.84
2024-03-01,10827,9552,14,682,8,6,1275,558,717,0.12,0.56,0.44,0.88
2024-02-01,10739,9298,13,715,8,5,1441,842,599,0.13,0.42,0.58,0.87
2024-01-01,11963,9935,18,552,9,9,2028,1175,853,0.17,0.42,0.58,0.83`,
"utils.py": `import pandas as pd

def cx_credit_mtree(df:pd.DataFrame,main_dt,comparator_dt):
    ''' 
    Args:
        df: pandas dataframe,
        main_dt: The date with the focus values
        comparator_dt: 
    Returns:
        dict with a structure:
            template = {
                'key':'0',
                'label': 'Metric',
                'value': '0',
                'comparator': '0',
                'styleClass': 'class',
                'children':[]
            }
    '''
    
    main_df = df[df['month']==main_dt]
    comparator_df = df[df['month']==comparator_dt]

    main_total_calls = int(main_df['total_calls'].iloc[0])
    main_answered_calls = int(main_df['answered'].iloc[0])
    main_answered_per_person = int(main_df['avg_answered_per_agent'].iloc[0])
    main_answered_agents_total = int(main_df['total_agents_answered'].iloc[0])
    main_overachiever = int(main_df['overachiever'].iloc[0])
    main_underachiever = int(main_df['underachiever'].iloc[0])

    main_missed_calls = int(main_df['missed'].iloc[0])
    main_missed_out_working_hrs = int(main_df['missed_out_of_working_hours'].iloc[0])
    main_missed_in_working_hrs = int(main_df['missed_in_of_working_hours'].iloc[0])

    comparator_total_calls = int(comparator_df['total_calls'].iloc[0])
    comparator_answered_calls = int(comparator_df['answered'].iloc[0])
    comparator_answered_per_person = int(comparator_df['avg_answered_per_agent'].iloc[0])
    comparator_answered_agents_total = int(comparator_df['total_agents_answered'].iloc[0])
    comparator_overachiever = int(comparator_df['overachiever'].iloc[0])
    comparator_underachiever = int(comparator_df['underachiever'].iloc[0])

    comparator_missed_calls = int(comparator_df['missed'].iloc[0])
    comparator_missed_out_working_hrs = int(comparator_df['missed_out_of_working_hours'].iloc[0])
    comparator_missed_in_working_hrs = int(comparator_df['missed_in_of_working_hours'].iloc[0])


    mtree = {
        'key':'0',
        'label': 'Inbound Calls',
        'value': main_total_calls,
        'comparator': comparator_total_calls,
        'styleClass': 'bg-success' if main_total_calls > comparator_total_calls else 'bg-danger',
        'children':[]
    }
    level_2_answered = {
                'key':'0_1',
                'label': 'Answered',
                'value': f'Calls: {main_answered_calls} ({main_answered_calls/main_total_calls :.0%})',
                'comparator': f'Calls: {comparator_answered_calls} ({comparator_answered_calls/comparator_total_calls :.0%})',
                'styleClass': 'bg-success' if main_answered_calls > comparator_answered_calls else 'bg-danger',
                'children':[
                ]
            }

    level_2_missed = {
                'key':'0_2',
                'label': 'Missed',
                'value': f'Calls: {main_missed_calls} ({main_missed_calls/main_total_calls :.0%})',
                'comparator': f'Calls: {comparator_missed_calls} ({comparator_missed_calls/comparator_total_calls :.0%})',
                'styleClass': 'bg-success' if main_missed_calls < comparator_missed_calls else 'bg-danger',
                'children':[
                ]
            }

    level_3_answered_avg_person = {
                'key':'0_1_1',
                'label': 'Avg Per Agent',
                'value': f'{main_answered_per_person} ({main_answered_agents_total} agents)',
                'comparator': f'{comparator_answered_per_person}({comparator_answered_agents_total} agents)',
                'styleClass': 'bg-success' if main_answered_per_person > comparator_answered_per_person else 'bg-danger',
                'children':[
                ]
            }

    level_3_missed_in_working_hrs = {
                'key':'0_2_1',
                'label': 'In Hrs',
                'value': f'Calls: {main_missed_in_working_hrs} ({main_missed_in_working_hrs/main_missed_calls :.0%})',
                'comparator': f'Calls: {comparator_missed_in_working_hrs} ({comparator_missed_in_working_hrs/main_missed_calls :.0%})',
                'styleClass': 'bg-success' if main_missed_in_working_hrs < comparator_missed_in_working_hrs else 'bg-danger',
            }

    level_3_missed_out_working_hrs = {
                'key':'0_2_2',
                'label': 'Off Hrs',
                'value': f'Calls: {main_missed_out_working_hrs} ({main_missed_out_working_hrs/main_missed_calls :.0%})',
                'comparator': f'Calls: {comparator_missed_out_working_hrs} ({comparator_missed_out_working_hrs/main_missed_calls :.0%})',
                'styleClass': 'bg-success' if main_missed_out_working_hrs < comparator_missed_out_working_hrs else 'bg-danger',
            }

    level_4_answered_avg_person_overperformers = {
                'key':'0_1_1_1',
                'label': 'Overachievers',
                'value': f'{main_overachiever} agents',
                'comparator': f'{comparator_overachiever} agents',
                'styleClass': 'bg-success' if main_overachiever > comparator_overachiever else 'bg-danger',
            }

    level_4_answered_avg_person_underperformers = {
                'key':'0_1_1_2',
                'label': 'Underachievers',
                'value': f'{main_underachiever} agents',
                'comparator': f'{comparator_underachiever} agents',
                'styleClass': 'bg-success' if main_underachiever > comparator_underachiever else 'bg-danger',
            }
    
    mtree['children'].append(level_2_answered)
    mtree['children'].append(level_2_missed)
    mtree['children'][0]['children'].append(level_3_answered_avg_person)
    mtree['children'][0]['children'][0]['children'].append(level_4_answered_avg_person_overperformers)
    mtree['children'][0]['children'][0]['children'].append(level_4_answered_avg_person_underperformers)
    mtree['children'][1]['children'].append(level_3_missed_in_working_hrs)
    mtree['children'][1]['children'].append(level_3_missed_out_working_hrs)

    metric_key_dict = {
        '0':'total_calls',
        '0_1':'answered',
        '0_1_1':'avg_answered_per_agent',
        '0_1_1_1':'overachiever',
        '0_1_1_2':'underachiever',
        '0_2':'missed',
        '0_2_1':'missed_in_of_working_hours',
        '0_2_2':'missed_out_of_working_hours',
    }

    return mtree, metric_key_dict`,

},
  },
  document.getElementById("root")
)

    </script>
  </body>
  <!-- Generated from Stlite Sharing (https://edit.share.stlite.net/), and the source version is 3e818f3f4a6ded7d39732a794935234b3d5d527c -->
</html>